<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
    <title>Kho tÃ i liá»‡u</title>
</head>
<body>

<div layout:fragment="content">

    <div class="search-bar-container">
        <form th:action="@{/documents}" method="GET" class="search-input-group">
            <span class="search-icon">ğŸ”</span>
            <input type="text" name="keyword" class="search-input"
                   placeholder="TÃ¬m kiáº¿m tÃ i liá»‡u, giÃ¡o trÃ¬nh, bÃ i táº­p..."
                   th:value="${keyword}">
            <input type="hidden" name="categoryId" th:if="${currentCategoryId}" th:value="${currentCategoryId}">
            <button type="submit" class="search-btn">TÃ¬m kiáº¿m</button>
        </form>
    </div>

    <div class="category-filter">
        <h5>ğŸ“‚ Danh má»¥c tÃ i liá»‡u</h5>
        <div class="category-list">
            <a th:href="@{/documents(keyword=${keyword})}"
               class="category-badge"
               th:classappend="${currentCategoryId == null} ? 'active' : ''">
                <span>ğŸŒ</span> Táº¥t cáº£
            </a>

            <a th:each="cat : ${categories}"
               th:href="@{/documents(categoryId=${cat.id}, keyword=${keyword})}"
               class="category-badge"
               th:classappend="${currentCategoryId == cat.id} ? 'active' : ''">
                <span th:text="${cat.icon}">ğŸ“</span>
                <span th:text="${cat.name}">Category Name</span>
            </a>
        </div>
    </div>

    <div class="documents-grid" th:if="${documents != null && !documents.isEmpty()}">
        <div class="document-card" th:each="doc : ${documents}"
             style="cursor: pointer;"
             th:onclick="'window.location.href=\'' + @{/download/{fileName}(fileName=${doc.storagePath})} + '\''">

            <div class="document-thumbnail">
                <div class="file-icon">
                    <span th:if="${doc.fileType != null && #strings.contains(doc.fileType, 'pdf')}">ğŸ“•</span>
                    <span th:if="${doc.fileType != null && (#strings.contains(doc.fileType, 'word') || #strings.contains(doc.fileType, 'officedocument'))}">ğŸ“</span>
                    <span th:if="${doc.fileType != null && (#strings.contains(doc.fileType, 'sheet') || #strings.contains(doc.fileType, 'excel'))}">ğŸ“Š</span>
                    <span th:if="${doc.fileType != null && #strings.contains(doc.fileType, 'presentation')}">ğŸ“½ï¸</span>
                    <span th:if="${doc.fileType == null || (!#strings.contains(doc.fileType, 'pdf') && !#strings.contains(doc.fileType, 'word') && !#strings.contains(doc.fileType, 'sheet') && !#strings.contains(doc.fileType, 'presentation'))}">ğŸ“</span>
                </div>
                <div class="file-type-badge"
                     th:if="${doc.fileName != null}"
                     th:text="${#strings.substringAfter(doc.fileName, '.').toUpperCase()}">FILE</div>
            </div>

            <div class="document-info">
                <div class="document-title" th:text="${doc.title != null ? doc.title : doc.fileName}">TiÃªu Ä‘á» tÃ i liá»‡u</div>
                <div class="document-description" th:text="${doc.description}">MÃ´ táº£ ngáº¯n gá»n...</div>

                <div class="document-tags" th:if="${doc.tags != null && !doc.tags.isEmpty()}">
                    <span class="tag-badge" th:each="tag : ${#strings.arraySplit(doc.tags, ',')}" th:text="${'#' + tag.trim()}">#java</span>
                </div>

                <div class="document-meta">
                    <div class="document-author">
                        <div class="author-avatar">
                            <span th:text="${doc.user != null ? #strings.substring(doc.user.name, 0, 1) : '?'}">A</span>
                        </div>
                        <span th:text="${doc.user != null ? doc.user.name : 'Unknown'}">User</span>
                    </div>

                    <a th:href="@{/download/{fileName}(fileName=${doc.storagePath})}"
                       class="btn btn-sm btn-primary"
                       style="border-radius: 20px; z-index: 10; position: relative;"
                       onclick="event.stopPropagation();">
                        â¬‡ Táº£i xuá»‘ng <span th:text="${doc.downloads}">0</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="empty-state" th:if="${documents == null || documents.isEmpty()}">
        <div class="empty-icon">ğŸ“­</div>
        <h4>KhÃ´ng tÃ¬m tháº¥y tÃ i liá»‡u nÃ o</h4>
        <p>Thá»­ tÃ¬m kiáº¿m vá»›i tá»« khÃ³a khÃ¡c hoáº·c chá»n danh má»¥c khÃ¡c.</p>
        <a th:href="@{/upload}" class="btn btn-primary mt-3">ÄÄƒng táº£i tÃ i liá»‡u ngay</a>
    </div>

    <a th:href="@{/upload}" class="upload-btn-float" title="ÄÄƒng táº£i tÃ i liá»‡u má»›i">
        +
    </a>

</div>

</body>
</html>