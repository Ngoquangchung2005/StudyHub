<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
    <title>ÄÄƒng táº£i tÃ i liá»‡u</title>
    <link th:href="@{/css/upload.css}" rel="stylesheet" />
</head>
<body>

<div layout:fragment="content">

    <div class="upload-container">

        <div class="upload-header">
            <h1>ğŸ“¤ ÄÄƒng táº£i tÃ i liá»‡u</h1>
            <p>Chia sáº» kiáº¿n thá»©c cá»§a báº¡n vá»›i cá»™ng Ä‘á»“ng há»c táº­p</p>
        </div>

        <form th:action="@{/posts/create}"
              th:object="${postDto}"
              method="POST"
              enctype="multipart/form-data"
              id="uploadForm">

            <div class="file-upload-zone" id="dropZone">
                <div class="file-icon-big">ğŸ“</div>
                <h4>KÃ©o tháº£ file vÃ o Ä‘Ã¢y</h4>
                <p>hoáº·c <strong>báº¥m Ä‘á»ƒ chá»n file tá»« mÃ¡y tÃ­nh</strong></p>
                <small style="color: #999;">Há»— trá»£: PDF, Word, Excel, PowerPoint, TXT (Max 50MB)</small>
                <input type="file"
                       id="fileInput"
                       th:field="*{files}"
                       accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt"
                       style="display: none;"
                       multiple
                       required>
            </div>

            <div class="file-selected" id="fileSelected">
                <div class="file-preview-icon" id="fileIcon">ğŸ“„</div>
                <div class="file-info">
                    <h5 id="fileName">file.pdf</h5>
                    <small id="fileSize">0 MB</small>
                </div>
                <button type="button" class="btn btn-danger" onclick="clearFile()" style="margin-left: auto;">
                    âŒ XÃ³a
                </button>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>ğŸ“ TiÃªu Ä‘á» tÃ i liá»‡u <span>*</span></label>
                    <input type="text"
                           class="form-control"
                           th:field="*{title}"
                           placeholder="VD: GiÃ¡o trÃ¬nh Láº­p trÃ¬nh Java cÆ¡ báº£n"
                           required>
                </div>
                <div class="form-group">
                    <label>ğŸ·ï¸ Tags (tá»« khÃ³a)</label>
                    <input type="text"
                           class="form-control"
                           th:field="*{tags}"
                           placeholder="VD: java, spring, backend">
                    <div class="tag-hint">
                        ğŸ’¡ PhÃ¢n cÃ¡ch báº±ng dáº¥u pháº©y
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ“„ MÃ´ táº£ chi tiáº¿t</label>
                <textarea class="form-control"
                          th:field="*{description}"
                          placeholder="MÃ´ táº£ ná»™i dung, Ä‘á»‘i tÆ°á»£ng phÃ¹ há»£p, kiáº¿n thá»©c cáº§n cÃ³..."></textarea>
            </div>

            <div class="form-group">
                <label>ğŸ“‚ Chá»n danh má»¥c <span>*</span></label>
                <div class="category-grid">
                    <div class="category-item" th:each="cat : ${categories}">
                        <input type="radio"
                               th:id="${'cat_' + cat.id}"
                               name="categoryId"
                               th:value="${cat.id}"
                               required>
                        <label th:for="${'cat_' + cat.id}" class="category-label">
                            <span class="category-icon" th:text="${cat.icon}">ğŸ“š</span>
                            <span class="category-name" th:text="${cat.name}">Category</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ”’ Quyá»n riÃªng tÆ°</label>

                <label class="privacy-option">
                    <input type="radio" name="isPublic" value="true" checked>
                    <div class="privacy-label">
                        <strong>ğŸŒ CÃ´ng khai</strong><br>
                        <small>Má»i ngÆ°á»i Ä‘á»u cÃ³ thá»ƒ xem vÃ  táº£i xuá»‘ng</small>
                    </div>
                </label>

                <label class="privacy-option">
                    <input type="radio" name="isPublic" value="false">
                    <div class="privacy-label">
                        <strong>ğŸ”’ RiÃªng tÆ°</strong><br>
                        <small>Chá»‰ mÃ¬nh tÃ´i cÃ³ thá»ƒ xem</small>
                    </div>
                </label>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">
                ğŸš€ ÄÄƒng táº£i ngay
            </button>

        </form>

    </div>

</div>

<script layout:fragment="scripts">
    // === FILE HANDLING ===
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileSelected = document.getElementById('fileSelected');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const fileIcon = document.getElementById('fileIcon');

    // Click to select file
    dropZone.addEventListener('click', () => fileInput.click());

    // File input change
    fileInput.addEventListener('change', handleFiles);

    // Drag & Drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            handleFiles();
        }
    });

    function handleFiles() {
        const files = fileInput.files;
        if (files.length > 0) {
            const file = files[0];

            fileName.textContent = file.name;
            fileSize.textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';

            // Set icon based on file type
            if (file.type.includes('pdf')) fileIcon.textContent = 'ğŸ“„';
            else if (file.type.includes('word')) fileIcon.textContent = 'ğŸ“';
            else if (file.type.includes('excel') || file.type.includes('spreadsheet')) fileIcon.textContent = 'ğŸ“Š';
            else if (file.type.includes('presentation')) fileIcon.textContent = 'ğŸ“½ï¸';
            else fileIcon.textContent = 'ğŸ“';

            fileSelected.classList.add('show');
            dropZone.style.display = 'none';

            // Auto-fill title if empty
            const titleInput = document.querySelector('input[name="title"]');
            if (!titleInput.value) {
                titleInput.value = file.name.replace(/\.[^/.]+$/, ""); // Remove extension
            }
        }
    }

    function clearFile() {
        fileInput.value = '';
        fileSelected.classList.remove('show');
        dropZone.style.display = 'block';
    }

    // Form submit
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerHTML = 'â³ Äang táº£i lÃªn...';
    });
</script>

</body>
</html>