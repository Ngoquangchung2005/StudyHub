<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
  <title>C√†i ƒë·∫∑t t√†i kho·∫£n</title>
  <link th:href="@{/css/auth.css}" rel="stylesheet" />
  <style>
    /* CSS cho ·∫£nh b√¨a preview */
    .cover-photo-preview {
      height: 200px;
      width: 100%;
      background-color: #e0e0e0;
      border-radius: 8px;
      margin-bottom: 10px;
      background-size: cover;
      background-position: center;
      border: 2px dashed #ccc;
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

<div layout:fragment="content">

    <div class="container mt-4 mb-5">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">

                <div class="card shadow-lg border-0" style="border-radius: 20px; overflow: hidden;">

                    <!-- Header -->
                    <div class="card-header text-black text-center py-4"
                         style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div style="font-size: 3rem; margin-bottom: 10px;">‚öôÔ∏è</div>
                        <h2 class="mb-1 fw-bold">C√†i ƒë·∫∑t t√†i kho·∫£n</h2>
                        <p class="mb-0" style="opacity: 0.9;">C·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n v√† profile c·ªßa b·∫°n</p>
                    </div>

                    <!-- Body -->
                    <div class="card-body p-4 p-md-5">

                        <!-- Success/Error Messages -->
                        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                            ‚úÖ <span th:text="${successMessage}"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                            ‚ùå <span th:text="${errorMessage}"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>

                        <!-- Form -->
                        <form th:action="@{/profile/edit}"
                              th:object="${profileDto}"
                              method="POST"
                              enctype="multipart/form-data">

                            <!-- ·∫¢nh b√¨a hi·ªán t·∫°i -->
                            <div class="mb-4 text-center">
                                <label class="form-label fw-bold text-muted mb-2">üì∑ ·∫¢nh b√¨a hi·ªán t·∫°i</label>
                                <div class="cover-photo-preview"
                                     th:style="${currentCoverPhotoUrl != null} ?
                     'background-image: url(' + @{/view-file/{fileName}(fileName=${currentCoverPhotoUrl})} + ')' :
                     'background-color: #e9ecef;'">
                                </div>
                            </div>

                            <!-- Upload ·∫£nh b√¨a m·ªõi -->
                            <div class="mb-4">
                                <label for="coverPhotoFile" class="form-label fw-bold">
                                    üñºÔ∏è T·∫£i l√™n ·∫£nh b√¨a m·ªõi
                                </label>
                                <input type="file"
                                       class="form-control"
                                       id="coverPhotoFile"
                                       th:field="*{coverPhotoFile}"
                                       accept="image/png, image/jpeg, image/gif"
                                       style="border-radius: 10px;">
                                <small class="form-text text-muted">ƒê·ªãnh d·∫°ng: PNG, JPG, GIF. K√≠ch th∆∞·ªõc ƒë·ªÅ xu·∫•t: 1200x400px</small>
                            </div>

                            <hr class="my-4">

                            <!-- Avatar hi·ªán t·∫°i -->
                            <div class="mb-4 text-center">
                                <label class="form-label fw-bold text-muted mb-3">üë§ Avatar hi·ªán t·∫°i</label>
                                <div>
                                    <img th:if="${currentAvatarUrl != null}"
                                         th:src="@{/view-file/{fileName}(fileName=${currentAvatarUrl})}"
                                         alt="Avatar"
                                         style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #667eea; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                    <div th:if="${currentAvatarUrl == null}"
                                         style="width: 120px; height: 120px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: inline-flex; align-items: center; justify-content: center; font-size: 60px; font-weight: bold; border: 4px solid #667eea; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                        üë§
                                    </div>
                                </div>
                            </div>

                            <!-- Upload avatar m·ªõi -->
                            <div class="mb-4">
                                <label for="avatarFile" class="form-label fw-bold">
                                    üì∏ T·∫£i l√™n avatar m·ªõi
                                </label>
                                <input type="file"
                                       class="form-control"
                                       id="avatarFile"
                                       th:field="*{avatarFile}"
                                       accept="image/png, image/jpeg, image/gif"
                                       style="border-radius: 10px;">
                                <small class="form-text text-muted">ƒê·ªãnh d·∫°ng: PNG, JPG, GIF. K√≠ch th∆∞·ªõc ƒë·ªÅ xu·∫•t: 400x400px</small>
                            </div>

                            <hr class="my-4">

                            <!-- Th√¥ng tin c√° nh√¢n -->
                            <h5 class="mb-3 fw-bold text-primary">üìù Th√¥ng tin c√° nh√¢n</h5>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="name" class="form-label fw-bold">H·ªç v√† t√™n <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="name" th:field="*{name}" required style="border-radius: 10px;">
                                </div>

                                <div class="col-md-6">
                                    <label for="userType" class="form-label fw-bold">Vai tr√≤</label>
                                    <select class="form-select" id="userType" th:field="*{userType}" style="border-radius: 10px;">
                                        <option value="">-- Ch·ªçn vai tr√≤ --</option>
                                        <option th:each="type : ${userTypes}"
                                                th:value="${type}"
                                                th:text="${type.displayName}">
                                        </option>
                                    </select>
                                </div>

                                <div class="col-md-6">
                                    <label for="school" class="form-label fw-bold">Tr∆∞·ªùng h·ªçc</label>
                                    <input type="text" class="form-control" id="school" th:field="*{school}"
                                           placeholder="VD: ƒê·∫°i h·ªçc B√°ch khoa ƒê√† N·∫µng" style="border-radius: 10px;">
                                </div>

                                <div class="col-md-6">
                                    <label for="major" class="form-label fw-bold">Chuy√™n ng√†nh</label>
                                    <input type="text" class="form-control" id="major" th:field="*{major}"
                                           placeholder="VD: C√¥ng ngh·ªá ph·∫ßn m·ªÅm" style="border-radius: 10px;">
                                </div>

                                <div class="col-md-6">
                                    <label for="location" class="form-label fw-bold">S·ªëng ·ªü</label>
                                    <input type="text" class="form-control" id="location" th:field="*{location}"
                                           placeholder="VD: ƒê√† N·∫µng" style="border-radius: 10px;">
                                </div>

                                <div class="col-md-6">
                                    <label for="hometown" class="form-label fw-bold">ƒê·∫øn t·ª´</label>
                                    <input type="text" class="form-control" id="hometown" th:field="*{hometown}"
                                           placeholder="VD: Hu·∫ø" style="border-radius: 10px;">
                                </div>

                                <div class="col-md-6">
                                    <label for="birthday" class="form-label fw-bold">Ng√†y sinh</label>
                                    <input type="date" class="form-control" id="birthday" th:field="*{birthday}" style="border-radius: 10px;">
                                </div>

                                <div class="col-md-6">
                                    <label for="contactPhone" class="form-label fw-bold">S·ªë ƒëi·ªán tho·∫°i</label>
                                    <input type="tel" class="form-control" id="contactPhone" th:field="*{contactPhone}"
                                           placeholder="VD: 0905123456" style="border-radius: 10px;">
                                </div>

                                <div class="col-12">
                                    <label for="bio" class="form-label fw-bold">Ti·ªÉu s·ª≠ (Bio)</label>
                                    <textarea class="form-control" id="bio" th:field="*{bio}" rows="4"
                                              placeholder="Vi·∫øt g√¨ ƒë√≥ v·ªÅ b·∫°n..." style="border-radius: 10px;"></textarea>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="mt-4 d-grid">
                                <button type="submit" class="btn btn-lg fw-bold text-black"
                                        style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 15px; padding: 15px;">
                                    üíæ L∆∞u thay ƒë·ªïi
                                </button>
                            </div>

                        </form>

                    </div>
                </div>

            </div>
        </div>
    </div>

</div>

<style>
    .cover-photo-preview {
        height: 200px;
        width: 100%;
        background-color: #e9ecef;
        border-radius: 15px;
        background-size: cover;
        background-position: center;
        border: 3px dashed #dee2e6;
        position: relative;
    }

    .cover-photo-preview::after {
        content: 'üñºÔ∏è ·∫¢nh b√¨a';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 1.2rem;
        color: #6c757d;
        font-weight: bold;
        opacity: 0.5;
    }

    .cover-photo-preview[style*="background-image"]::after {
        display: none;
    }
</style>

</div>
</body>
</html>