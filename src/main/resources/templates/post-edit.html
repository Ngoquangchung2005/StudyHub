<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
    <title>Chá»‰nh sá»­a bÃ i Ä‘Äƒng</title>
    <link th:href="@{/css/upload.css}" rel="stylesheet" />
</head>
<body>

<div layout:fragment="content">

    <div class="upload-container">

        <div class="upload-header">
            <h1>âœï¸ Chá»‰nh sá»­a bÃ i Ä‘Äƒng</h1>
            <p>Cáº­p nháº­t thÃ´ng tin tÃ i liá»‡u vÃ  bÃ i viáº¿t cá»§a báº¡n</p>
        </div>

        <form th:action="@{/posts/edit/{id}(id=${postId})}"
              th:object="${postDto}"
              method="POST"
              enctype="multipart/form-data"
              id="uploadForm">

            <div class="form-group" th:if="${existingDocuments != null && !existingDocuments.isEmpty()}">
                <label>ğŸ“‚ TÃ i liá»‡u hiá»‡n cÃ³:</label>
                <ul class="list-group">
                    <li class="list-group-item d-flex justify-content-between align-items-center"
                        th:each="doc : ${existingDocuments}">
                        <span>
                            ğŸ“„ <span th:text="${doc.fileName}">file.pdf</span>
                            <span class="text-muted ms-2" th:text="'(' + ${doc.views} + ' lÆ°á»£t xem)'"></span>
                        </span>
                        <span class="badge bg-primary rounded-pill">ÄÃ£ lÆ°u</span>
                    </li>
                </ul>
                <small class="text-muted mt-1 d-block">
                    * Náº¿u báº¡n táº£i lÃªn file má»›i bÃªn dÆ°á»›i, nÃ³ sáº½ Ä‘Æ°á»£c thÃªm vÃ o bÃ i Ä‘Äƒng nÃ y.
                </small>
            </div>

            <div class="file-upload-zone" id="dropZone">
                <div class="file-icon-big">ğŸ“</div>
                <h4>Táº£i thÃªm file (náº¿u muá»‘n)</h4>
                <p>hoáº·c <strong>báº¥m Ä‘á»ƒ chá»n</strong></p>
                <input type="file"
                       id="fileInput"
                       th:field="*{files}"
                       accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt"
                       style="display: none;"
                       multiple>
            </div>

            <div class="file-selected" id="fileSelected">
                <div class="file-preview-icon" id="fileIcon">ğŸ“„</div>
                <div class="file-info">
                    <h5 id="fileName">file.pdf</h5>
                    <small id="fileSize">0 MB</small>
                </div>
                <button type="button" class="btn btn-danger" onclick="clearFile()" style="margin-left: auto;">
                    âŒ Há»§y file má»›i
                </button>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>ğŸ“ TiÃªu Ä‘á» tÃ i liá»‡u</label>
                    <input type="text" class="form-control" th:field="*{title}" placeholder="VD: GiÃ¡o trÃ¬nh Java">
                </div>
                <div class="form-group">
                    <label>ğŸ·ï¸ Tags</label>
                    <input type="text" class="form-control" th:field="*{tags}" placeholder="VD: java, spring">
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ“„ MÃ´ táº£ chi tiáº¿t / Ná»™i dung bÃ i Ä‘Äƒng</label>
                <textarea class="form-control" th:field="*{description}"></textarea>
                <input type="hidden" th:field="*{content}" id="hiddenContent">
            </div>

            <div class="form-group">
                <label>ğŸ“‚ Chá»n danh má»¥c</label>
                <div class="category-grid">
                    <div class="category-item" th:each="cat : ${categories}">
                        <input type="radio"
                               th:id="${'cat_' + cat.id}"
                               name="categoryId"
                               th:value="${cat.id}"
                               th:checked="${postDto.categoryId == cat.id}">
                        <label th:for="${'cat_' + cat.id}" class="category-label">
                            <span class="category-icon" th:text="${cat.icon}">ğŸ“š</span>
                            <span class="category-name" th:text="${cat.name}">Category</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>ğŸ”’ Quyá»n riÃªng tÆ°</label>
                <label class="privacy-option">
                    <input type="radio" name="isPublic" value="true" th:checked="${postDto.isPublic == true}">
                    <div class="privacy-label"><strong>ğŸŒ CÃ´ng khai</strong><br><small>Má»i ngÆ°á»i Ä‘á»u cÃ³ thá»ƒ xem</small></div>
                </label>
                <label class="privacy-option">
                    <input type="radio" name="isPublic" value="false" th:checked="${postDto.isPublic == false}">
                    <div class="privacy-label"><strong>ğŸ”’ RiÃªng tÆ°</strong><br><small>Chá»‰ mÃ¬nh tÃ´i xem</small></div>
                </label>
            </div>

            <div class="d-flex gap-3">
                <a th:href="@{/}" class="btn btn-secondary flex-grow-1 py-3" style="border-radius: 15px;">Há»§y</a>
                <button type="submit" class="btn-submit flex-grow-1" id="submitBtn">ğŸ’¾ LÆ°u thay Ä‘á»•i</button>
            </div>

        </form>

    </div>

</div>

<script layout:fragment="scripts">
    // (Copy nguyÃªn Ä‘oáº¡n script tá»« upload.html sang Ä‘Ã¢y Ä‘á»ƒ xá»­ lÃ½ kÃ©o tháº£ file)
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileSelected = document.getElementById('fileSelected');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const fileIcon = document.getElementById('fileIcon');
    const descInput = document.querySelector('textarea[name="description"]');
    const contentInput = document.getElementById('hiddenContent');

    // Sync description to content on submit
    document.getElementById('uploadForm').addEventListener('submit', function() {
        if(descInput) contentInput.value = descInput.value;
    });

    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', handleFiles);
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
    dropZone.addEventListener('dragleave', () => { dropZone.classList.remove('dragover'); });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault(); dropZone.classList.remove('dragover');
        if (e.dataTransfer.files.length > 0) { fileInput.files = e.dataTransfer.files; handleFiles(); }
    });

    function handleFiles() {
        const files = fileInput.files;
        if (files.length > 0) {
            const file = files[0];
            fileName.textContent = file.name;
            fileSize.textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
            fileSelected.classList.add('show');
            dropZone.style.display = 'none';
        }
    }

    function clearFile() {
        fileInput.value = '';
        fileSelected.classList.remove('show');
        dropZone.style.display = 'block';
    }
</script>

</body>
</html>